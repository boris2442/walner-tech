import{d as h,r as x,L as C,c as a,b as n,u as o,e as O,f as U,k as l,E as $,O as k,j as _,l as d,F as p,q as m,m as c,R as y,_ as E}from"./app-B8Bday2e.js";import{_ as f}from"./Input-BOSJEhqG.js";import{_ as F,a as L}from"./SubmitButton-Dv8mQMLY.js";import{_ as M}from"./BackButton-C_szFXQc.js";import{p as N,_ as q}from"./AppLayout.vue_vue_type_script_setup_true_lang-BoyDBkxR.js";import{d as D}from"./index-BdvXPHPK.js";import"./index-Co3i_p4M.js";import"./useForwardExpose-Deeoe7Gk.js";import"./VisuallyHidden-f2_6kO3v.js";import"./RovingFocusGroup-DMmuWBLL.js";import"./useArrowNavigation-C6Y-ieo6.js";import"./AppLogoIcon.vue_vue_type_script_setup_true_lang-tX-IWcWs.js";const R={class:"p-4"},j=["value"],B={key:0,class:"mt-1 text-sm text-red-500"},P={class:"mt-2 flex flex-wrap gap-2"},T=["src"],X=["onClick"],A=["src"],H={key:0,class:"mt-1 text-sm text-red-500"},se=h({__name:"Edit",props:{product:{},categories:{}},setup(g){const i=g,u=x(i.product.images.map(s=>({id:s.id,url:s.url_image}))),t=C({title:i.product.title,description:i.product.description,prix:Number(i.product.prix),stock:Number(i.product.stock),category_id:Number(i.product.category_id),status:i.product.status,newImages:[],keepOldImages:u.value.map(s=>s.id)}),b=x([]),w=s=>{u.value=u.value.filter(e=>e.id!==s),t.keepOldImages=u.value.map(e=>e.id)},V=s=>{const e=s.target;e.files&&(t.newImages=Array.from(e.files),b.value=t.newImages.map(r=>URL.createObjectURL(r)))},I=()=>{if(u.value.length===0&&t.newImages.length===0){alert("Le produit doit avoir au moins une image.");return}const s=new FormData;s.append("_method","put"),s.append("title",t.title),s.append("description",t.description),s.append("prix",t.prix.toString()),s.append("stock",t.stock.toString()),s.append("category_id",t.category_id.toString()),s.append("status",t.status),t.keepOldImages.forEach(e=>{s.append("keepOldImages[]",e.toString())}),t.newImages.forEach(e=>{s.append("images[]",e)}),E.post(`/admin/products/${i.product.id}`,s,{headers:{"Content-Type":"multipart/form-data","X-Requested-With":"XMLHttpRequest","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")}}).then(e=>{router.visit("/admin/products",{method:"get",replace:!1,preserveState:!1,preserveScroll:!1,preserveOrigin:!1,onSuccess:()=>{},onError:r=>{}})}).catch(e=>{})},S=[{title:"Dashboard",href:D().url},{title:"Products List",href:N.index().url},{title:"Modifier produit",href:`/admin/products/${i.product.id}/edit`}];return(s,e)=>(d(),a(p,null,[n(o(O),{title:"Modifier un produit"}),n(q,{breadcrumbs:S},{default:U(()=>[l("div",R,[n(M,{class:"m-4"}),e[11]||(e[11]=l("h1",{class:"mb-4 text-xl font-bold"},"Modifier le produit",-1)),l("form",{onSubmit:$(I,["prevent"]),class:"flex flex-col gap-4"},[n(f,{label:"Titre",id:"title",modelValue:o(t).title,"onUpdate:modelValue":e[0]||(e[0]=r=>o(t).title=r),error:o(t).errors.title},null,8,["modelValue","error"]),n(F,{label:"Description",modelValue:o(t).description,"onUpdate:modelValue":e[1]||(e[1]=r=>o(t).description=r),error:o(t).errors.description,rows:4},null,8,["modelValue","error"]),n(f,{label:"Prix",type:"number",modelValue:o(t).prix,"onUpdate:modelValue":e[2]||(e[2]=r=>o(t).prix=r),error:o(t).errors.prix,required:""},null,8,["modelValue","error"]),n(f,{label:"Stock",type:"number",modelValue:o(t).stock,"onUpdate:modelValue":e[3]||(e[3]=r=>o(t).stock=r),error:o(t).errors.stock,required:""},null,8,["modelValue","error"]),l("div",null,[e[7]||(e[7]=l("label",{class:"mb-1 block font-medium"},"Catégorie",-1)),k(l("select",{"onUpdate:modelValue":e[4]||(e[4]=r=>o(t).category_id=r),class:"w-full rounded border p-2 focus:ring-2 focus:ring-blue-500 focus:outline-none"},[e[6]||(e[6]=l("option",{value:"",disabled:""},"Choisir une catégorie",-1)),(d(!0),a(p,null,m(g.categories,r=>(d(),a("option",{key:r.id,value:r.id},c(r.name),9,j))),128))],512),[[y,o(t).category_id]]),o(t).errors.category_id?(d(),a("p",B,c(o(t).errors.category_id),1)):_("",!0)]),l("div",null,[e[8]||(e[8]=l("label",{class:"mb-1 block font-medium"},"Images",-1)),l("input",{type:"file",multiple:"",accept:"image/*",onChange:V,class:"block w-full"},null,32),l("div",P,[(d(!0),a(p,null,m(u.value,r=>(d(),a("div",{key:r.id,class:"relative"},[l("img",{src:r.url,class:"h-24 w-24 rounded border object-cover"},null,8,T),l("button",{type:"button",onClick:v=>w(r.id),class:"absolute -top-2 -right-2 rounded-full bg-red-600 px-1.5 text-xs text-white hover:bg-red-700"}," x ",8,X)]))),128)),(d(!0),a(p,null,m(b.value,(r,v)=>(d(),a("div",{key:v,class:"relative"},[l("img",{src:r,class:"h-24 w-24 rounded border object-cover"},null,8,A)]))),128))]),o(t).errors.images?(d(),a("p",H,c(o(t).errors.images),1)):_("",!0)]),l("div",null,[e[10]||(e[10]=l("label",{class:"mb-1 block font-medium"},"Statut",-1)),k(l("select",{"onUpdate:modelValue":e[5]||(e[5]=r=>o(t).status=r),class:"w-full rounded border p-2 focus:ring-2 focus:ring-blue-500 focus:outline-none"},[...e[9]||(e[9]=[l("option",{value:"disponible"},"Disponible",-1),l("option",{value:"indisponible"},"Indisponible",-1)])],512),[[y,o(t).status]])]),n(L,{processing:o(t).processing,label:"Mettre à jour"},null,8,["processing"])],32)])]),_:1})],64))}});export{se as default};
