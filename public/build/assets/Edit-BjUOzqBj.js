import{d as $,r as x,L as M,c as a,b as n,u as l,e as N,f as F,k as r,E as O,O as k,j as w,l as d,F as p,q as g,m as f,R as y,p as h,_ as j}from"./app-BiLXB_Gm.js";import{_ as b}from"./Input-BlLIRTr1.js";import{_ as E,a as U}from"./SubmitButton-CXAYjg5R.js";import{_ as q}from"./BackButton-CzwGPDa-.js";import{p as D,_ as L}from"./AppLayout.vue_vue_type_script_setup_true_lang-G5aJeSxS.js";import{d as B}from"./index-BdvXPHPK.js";import"./index-uZ0nkAcw.js";import"./useForwardExpose-D7JHDv8x.js";import"./VisuallyHidden-DjQmEh-o.js";import"./RovingFocusGroup-nIneY0yw.js";import"./useArrowNavigation-C6Y-ieo6.js";import"./AppLogoIcon.vue_vue_type_script_setup_true_lang-CO70Gl9y.js";const P={class:"p-4"},R=["value"],G={key:0,class:"mt-1 text-sm text-red-500"},T={class:"mt-2 flex flex-wrap gap-2"},z=["src"],X=["onClick"],A=["src"],W=["onClick"],H={key:0,class:"mt-1 text-sm text-red-500"},de=$({__name:"Edit",props:{product:{},categories:{}},setup(v){const i=v,u=x(i.product.images.map(s=>({id:s.id,url:s.url_image}))),t=M({title:i.product.title,description:i.product.description,prix:Number(i.product.prix),stock:Number(i.product.stock),category_id:Number(i.product.category_id),status:i.product.status,newImages:[],keepOldImages:u.value.map(s=>s.id)}),m=x([]),V=s=>{u.value=u.value.filter(e=>e.id!==s),t.keepOldImages=u.value.map(e=>e.id)},I=s=>{const e=s.target;e.files&&(t.newImages=Array.from(e.files),m.value=t.newImages.map(o=>URL.createObjectURL(o)))},_=()=>{if(u.value.length===0&&t.newImages.length===0){alert("Le produit doit avoir au moins une image.");return}const s=new FormData;s.append("_method","put"),s.append("title",t.title),s.append("description",t.description),s.append("prix",t.prix.toString()),s.append("stock",t.stock.toString()),s.append("category_id",t.category_id.toString()),s.append("status",t.status),t.keepOldImages.forEach(e=>{s.append("keepOldImages[]",e.toString())}),t.newImages.forEach(e=>{s.append("images[]",e)}),j.post(`/admin/products/${i.product.id}`,s,{forceFormData:!0,headers:{"Content-Type":"multipart/form-data","X-Requested-With":"XMLHttpRequest","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")}}).then(e=>{router.visit("/admin/products",{method:"get",replace:!1,preserveState:!1,preserveScroll:!1,preserveOrigin:!1,onSuccess:()=>{},onError:o=>{}})}).catch(e=>{})},C=s=>{m.value.splice(s,1),t.newImages.splice(s,1)},S=[{title:"Dashboard",href:B().url},{title:"Products List",href:D.index().url},{title:"Modifier produit",href:`/admin/products/${i.product.id}/edit`}];return(s,e)=>(d(),a(p,null,[n(l(N),{title:"Modifier un produit"}),n(L,{breadcrumbs:S},{default:F(()=>[r("div",P,[n(q,{class:"m-4"}),e[14]||(e[14]=r("h1",{class:"mb-4 text-xl font-bold"},"Modifier le produit",-1)),r("form",{onSubmit:O(_,["prevent"]),class:"flex flex-col gap-4"},[n(b,{label:"Titre",id:"title",modelValue:l(t).title,"onUpdate:modelValue":e[0]||(e[0]=o=>l(t).title=o),error:l(t).errors.title},null,8,["modelValue","error"]),n(E,{label:"Description",modelValue:l(t).description,"onUpdate:modelValue":e[1]||(e[1]=o=>l(t).description=o),error:l(t).errors.description,rows:4},null,8,["modelValue","error"]),n(b,{label:"Prix",type:"number",modelValue:l(t).prix,"onUpdate:modelValue":e[2]||(e[2]=o=>l(t).prix=o),error:l(t).errors.prix,required:""},null,8,["modelValue","error"]),n(b,{label:"Stock",type:"number",modelValue:l(t).stock,"onUpdate:modelValue":e[3]||(e[3]=o=>l(t).stock=o),error:l(t).errors.stock,required:""},null,8,["modelValue","error"]),r("div",null,[e[8]||(e[8]=r("label",{class:"mb-1 block font-medium"},"Catégorie",-1)),k(r("select",{"onUpdate:modelValue":e[4]||(e[4]=o=>l(t).category_id=o),class:"w-full rounded border p-2 focus:ring-2 focus:ring-blue-500 focus:outline-none"},[e[7]||(e[7]=r("option",{value:"",disabled:""},"Choisir une catégorie",-1)),(d(!0),a(p,null,g(v.categories,o=>(d(),a("option",{key:o.id,value:o.id},f(o.name),9,R))),128))],512),[[y,l(t).category_id]]),l(t).errors.category_id?(d(),a("p",G,f(l(t).errors.category_id),1)):w("",!0)]),r("div",null,[e[11]||(e[11]=r("label",{class:"mb-1 block font-medium text-[var(--primary-blue)] dark:text-[var(--dark-gold)]"}," Images * ",-1)),r("div",{class:"mt-1 flex h-32 w-full cursor-pointer flex-col items-center justify-center rounded-lg border-2 border-dashed hover:border-[var(--primary-blue)] dark:hover:border-[var(--dark-gold)]",onClick:e[5]||(e[5]=o=>s.$refs.fileInput.click())},[e[9]||(e[9]=r("svg",{xmlns:"http://www.w3.org/2000/svg",class:"mb-2 h-8 w-8 text-blue-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[r("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 16v1a2 2 0 002 2h12a2 2 0 002-2v-1M12 12V4m0 0l-4 4m4-4l4 4"})],-1)),e[10]||(e[10]=r("p",{class:"text-sm text-gray-500"},[r("span",{class:"text-purple-600"},"Cliquez pour uploader"),h(" ou glissez-déposez"),r("br"),h(" PNG, JPG, GIF, SVG, WEBP (max. 2MB) ")],-1)),r("input",{ref:"fileInput",type:"file",multiple:"",accept:"image/png, image/jpeg, image/gif, image/svg+xml, image/webp",onChange:I,class:"hidden"},null,544)]),r("div",T,[(d(!0),a(p,null,g(u.value,o=>(d(),a("div",{key:o.id,class:"relative"},[r("img",{src:o.url,class:"h-24 w-24 rounded border object-cover"},null,8,z),r("button",{type:"button",onClick:c=>V(o.id),class:"absolute -top-2 -right-2 rounded-full bg-red-600 px-1.5 text-xs text-white hover:bg-red-700"}," × ",8,X)]))),128)),(d(!0),a(p,null,g(m.value,(o,c)=>(d(),a("div",{key:c,class:"relative"},[r("img",{src:o,class:"h-24 w-24 rounded border object-cover"},null,8,A),r("button",{type:"button",onClick:J=>C(c),class:"absolute -top-2 -right-2 rounded-full bg-red-600 px-1.5 text-xs text-white hover:bg-red-700"}," × ",8,W)]))),128))]),l(t).errors.images?(d(),a("p",H,f(l(t).errors.images),1)):w("",!0)]),r("div",null,[e[13]||(e[13]=r("label",{class:"mb-1 block font-medium"},"Statut",-1)),k(r("select",{"onUpdate:modelValue":e[6]||(e[6]=o=>l(t).status=o),class:"w-full rounded border p-2 focus:ring-2 focus:ring-blue-500 focus:outline-none"},[...e[12]||(e[12]=[r("option",{value:"disponible"},"Disponible",-1),r("option",{value:"indisponible"},"Indisponible",-1)])],512),[[y,l(t).status]])]),n(U,{processing:l(t).processing,label:"Mettre à jour"},null,8,["processing"])],32)])]),_:1})],64))}});export{de as default};
